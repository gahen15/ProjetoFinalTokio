-- Criação da Sequence
CREATE SEQUENCE seq_cliente
START WITH 1
INCREMENT BY 1
CACHE 10;

-- Criação da tabela T_Cliente
CREATE TABLE T_Cliente (
    idCliente NUMBER PRIMARY KEY,
    nome VARCHAR2(255) NOT NULL,
    email VARCHAR2(255) NOT NULL,
    telefone VARCHAR2(15),
    endereco VARCHAR2(255),
    tipoCliente VARCHAR2(10) NOT NULL, -- FISICA ou JURIDICA
    dataCadastro DATE NOT NULL
);

-- Criação do Trigger
CREATE OR REPLACE TRIGGER trg_cliente
BEFORE INSERT ON T_Cliente
FOR EACH ROW
BEGIN
    IF :NEW.idCliente IS NULL THEN
        SELECT seq_cliente.NEXTVAL INTO :NEW.idCliente FROM DUAL;
    END IF;
END;
/

-- Criação da tabela TipoSeguro
CREATE TABLE TipoSeguro (
    idTipoSeguro NUMBER PRIMARY KEY,
    descricao VARCHAR2(255) NOT NULL,
    categoria VARCHAR2(20) NOT NULL -- Categoria: 'Pessoa Física' ou 'Pessoa Jurídica'
);

-- Inserção de dados na tabela TipoSeguro
INSERT INTO TipoSeguro (idTipoSeguro, descricao, categoria) VALUES (1, 'Individual', 'Pessoa Física');
INSERT INTO TipoSeguro (idTipoSeguro, descricao, categoria) VALUES (2, 'Estagiário', 'Pessoa Física');
INSERT INTO TipoSeguro (idTipoSeguro, descricao, categoria) VALUES (3, 'Escolar', 'Pessoa Jurídica');
INSERT INTO TipoSeguro (idTipoSeguro, descricao, categoria) VALUES (4, 'Turismo', 'Pessoa Jurídica');
INSERT INTO TipoSeguro (idTipoSeguro, descricao, categoria) VALUES (5, 'Transporte de Pessoas', 'Pessoa Jurídica');
INSERT INTO TipoSeguro (idTipoSeguro, descricao, categoria) VALUES (6, 'Coletivo', 'Pessoa Jurídica');

-- Criação da tabela ClienteSeguro
CREATE TABLE ClienteSeguro (
    idCliente NUMBER,
    idTipoSeguro NUMBER,
    PRIMARY KEY (idCliente, idTipoSeguro),
    CONSTRAINT fk_cliente FOREIGN KEY (idCliente) REFERENCES T_Cliente(idCliente),
    CONSTRAINT fk_tipo_seguro FOREIGN KEY (idTipoSeguro) REFERENCES TipoSeguro(idTipoSeguro)
);

-- Criação da tabela T_PessoaFisica
CREATE TABLE T_PessoaFisica (
    idCliente NUMBER PRIMARY KEY,
    cpf VARCHAR2(11) UNIQUE NOT NULL,
    estadoCivil VARCHAR2(20),
    profissao VARCHAR2(100),
    dataNascimento DATE,
    CONSTRAINT fk_cliente_pfisica FOREIGN KEY (idCliente) REFERENCES T_Cliente(idCliente)
);

-- Criação da tabela T_Empresa
CREATE TABLE T_Empresa (
    idCliente NUMBER PRIMARY KEY,
    cnpj VARCHAR2(14) UNIQUE NOT NULL,
    nomeFantasia VARCHAR2(255),
    razaoSocial VARCHAR2(255),
    CONSTRAINT fk_cliente_empresa FOREIGN KEY (idCliente) REFERENCES T_Cliente(idCliente)
);
